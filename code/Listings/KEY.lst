C51 COMPILER V9.60.7.0   KEY                                                               12/25/2025 11:33:45 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\KEY.obj
COMPILER INVOKED BY: C:\Users\Alex\AppData\Local\Keil5\C51\BIN\C51.EXE Drivers\KEY.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\D
                    -rivers) DEBUG OBJECTEXTEND PRINT(.\Listings\KEY.lst) TABS(2) OBJECT(.\Objects\KEY.obj)

line level    source

   1          /**
   2           * @file KEY.C
   3           * @brief 51单片机独立按键扫描实现文件
   4           *
   5           * 实现独立按键的扫描与消抖处理
   6           * 支持单次触发模式和连续触发模式
   7           */
   8          
   9          #include "KEY.H"
  10          
  11          uint8_t key_scan(uint8_t mode) {
  12   1        static bit key_state = 1;  // 按键状态机状态：1=可检测按下，0=已按下或正在消抖
  13   1      
  14   1        if (mode) {
  15   2          // 连续触发模式：每次调用都允许重新检测按键
  16   2          key_state = 1;
  17   2        }
  18   1      
  19   1        if (key_state == 1 &&
  20   1            (KEY_1 == 0 || KEY_2 == 0 || KEY_3 == 0 || KEY_4 == 0)) {
  21   2          // 有任意按键被按下
  22   2          delay_10us(100);
  23   2      
  24   2          key_state = 0;  // 锁定状态，防止重复触发
  25   2      
  26   2          if (KEY_1 == 0)
  27   2            return KEY_1_PRESS;
  28   2          else if (KEY_2 == 0)
  29   2            return KEY_2_PRESS;
  30   2          else if (KEY_3 == 0)
  31   2            return KEY_3_PRESS;
  32   2          else if (KEY_4 == 0)
  33   2            return KEY_4_PRESS;
  34   2        }
  35   1      
  36   1        else if (KEY_1 == 1 && KEY_2 == 1 && KEY_3 == 1 && KEY_4 == 1) {
  37   2          // 所有按键都释放，则恢复检测状态
  38   2          key_state = 1;
  39   2        }
  40   1      
  41   1        return KEY_UNPRESS;
  42   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     70    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
