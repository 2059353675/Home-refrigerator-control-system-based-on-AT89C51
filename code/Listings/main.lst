C51 COMPILER V9.60.7.0   MAIN                                                              12/23/2025 16:35:22 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Users\Alex\AppData\Local\Keil5\C51\BIN\C51.EXE Tasks\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Dr
                    -ivers) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          /**
   2           * @file main.c
   3           * @brief RTX51 Tiny Dual Temperature Control System
   4           * Using DS18B20 sensors + LCD1602 display + Dual compressor control
   5           */
   6          
   7          #include <rtx51tny.h>  // RTX51 Tiny kernel functions
   8          
   9          #include "DEV51.H"
  10          #include "DS18B20.H"
  11          #include "LCD1602.H"
  12          
  13          // Compressor control pins
  14          sbit COMPRESSOR_REFRIG_PIN = P1 ^ 4;  // Refrigerator compressor
  15          sbit COMPRESSOR_FREEZE_PIN = P1 ^ 5;  // Freezer compressor
  16          
  17          // Sensor ROM IDs
  18          uint8_t rom_id_refrig[8] = {0x28, 0x30, 0xC5, 0xB8,
  19                                      0x22, 0x00, 0x00, 0x55};  // Refrigerator
  20          uint8_t rom_id_freeze[8] = {0x28, 0x30, 0xC5, 0xB8,
  21                                      0x33, 0x00, 0x00, 0xB4};  // Freezer
  22          
  23          // Target temperatures (in 0.1 degree units)
  24          #define SET_TEMP_REFRIG 40    // Refrigerator target: 4.0C
  25          #define SET_TEMP_FREEZE -180  // Freezer target: -18.0C
  26          
  27          #define HYSTERESIS_REFRIG_UP 45      // Refrigerator hysteresis upper: 4.5C
  28          #define HYSTERESIS_REFRIG_DOWN 35    // Refrigerator hysteresis lower: 3.5C
  29          #define HYSTERESIS_FREEZE_UP -175    // Freezer hysteresis upper: -17.5C
  30          #define HYSTERESIS_FREEZE_DOWN -185  // Freezer hysteresis lower: -18.5C
  31          
  32          // Global variables
  33          int16_t temp_refrig;              // Current refrigerator temperature
  34          int16_t temp_freeze;              // Current freezer temperature
  35          uint8_t temp_str[16];             // Temperature string buffer
  36          uint8_t display_update_flag = 0;  // Flag to trigger display update
  37          
  38          /**
  39           * @brief Format temperature value to string
  40           */
  41          void format_temp_string(int16_t temp, uint8_t* str) {
  42   1        uint8_t int_part, dec_part;
  43   1        uint8_t is_negative = 0;
  44   1        uint8_t idx = 0;
  45   1        uint16_t temp_abs;
  46   1      
  47   1        if (temp < 0) {
  48   2          is_negative = 1;
  49   2          temp_abs = -temp;
  50   2        } else {
  51   2          temp_abs = temp;
  52   2        }
  53   1      
  54   1        int_part = temp_abs / 10;
C51 COMPILER V9.60.7.0   MAIN                                                              12/23/2025 16:35:22 PAGE 2   

  55   1        dec_part = temp_abs % 10;
  56   1      
  57   1        if (is_negative) {
  58   2          str[idx++] = '-';
  59   2        } else {
  60   2          str[idx++] = ' ';
  61   2        }
  62   1      
  63   1        // Handle hundreds, tens, and units
  64   1        if (int_part >= 100) {
  65   2          str[idx++] = (int_part / 100) + '0';
  66   2          str[idx++] = ((int_part / 10) % 10) + '0';
  67   2          str[idx++] = (int_part % 10) + '0';
  68   2        } else if (int_part >= 10) {
  69   2          str[idx++] = (int_part / 10) + '0';
  70   2          str[idx++] = (int_part % 10) + '0';
  71   2        } else {
  72   2          str[idx++] = ' ';
  73   2          str[idx++] = (int_part % 10) + '0';
  74   2        }
  75   1      
  76   1        str[idx++] = '.';
  77   1        str[idx++] = dec_part + '0';
  78   1        str[idx++] = 'C';
  79   1        str[idx] = '\0';
  80   1      }
  81          
  82          /**
  83           * @brief Task 0: System initialization
  84           */
  85          void task_init(void) _task_ 0 {
  86   1        // Initialize hardware
  87   1        COMPRESSOR_REFRIG_PIN = 0;
  88   1        COMPRESSOR_FREEZE_PIN = 0;
  89   1        lcd1602_init();
  90   1        lcd1602_clear();
  91   1      
  92   1        // Display labels
  93   1        lcd1602_show_string(0, 0, "Ref:");
  94   1        lcd1602_show_string(0, 1, "Fre:");
  95   1      
  96   1        // Activate other tasks
  97   1        os_create_task(1);  // Temperature reading task
  98   1        os_create_task(2);  // Display update task
  99   1        os_create_task(3);  // Compressor control task
 100   1      
 101   1        // Start system timer
 102   1        os_start_system();
*** WARNING C206 IN LINE 102 OF Tasks\main.c: 'os_start_system': missing function-prototype
 103   1      
 104   1        // This task becomes the idle task
 105   1        while (1) {
 106   2          os_wait(K_SIG, 0, 0);  // Wait for signals
 107   2        }
 108   1      }
 109          
 110          /**
 111           * @brief Task 1: Temperature reading task
 112           */
 113          void task_temp_read(void) _task_ 1 {
 114   1        while (1) {
 115   2          // Read refrigerator temperature
C51 COMPILER V9.60.7.0   MAIN                                                              12/23/2025 16:35:22 PAGE 3   

 116   2          temp_refrig = get_temper(rom_id_refrig);
 117   2      
 118   2          // Read freezer temperature
 119   2          temp_freeze = get_temper(rom_id_freeze);
 120   2      
 121   2          // Set flag to update display
 122   2          display_update_flag = 1;
 123   2      
 124   2          // Wait for 1 second (100 ticks of 10ms each)
 125   2          os_wait(K_TMO, 100, 0);
 126   2        }
 127   1      }
 128          
 129          /**
 130           * @brief Task 2: Display update task
 131           */
 132          void task_display(void) _task_ 2 {
 133   1        while (1) {
 134   2          if (display_update_flag) {
 135   3            // Format and display refrigerator temperature
 136   3            format_temp_string((int16_t)temp_refrig, temp_str);
 137   3            lcd1602_show_string(8, 0, temp_str);
 138   3      
 139   3            // Format and display freezer temperature
 140   3            format_temp_string((int16_t)temp_freeze, temp_str);
 141   3            lcd1602_show_string(8, 1, temp_str);
 142   3      
 143   3            display_update_flag = 0;
 144   3          }
 145   2      
 146   2          // Wait for 500ms (50 ticks of 10ms each) before checking again
 147   2          os_wait(K_TMO, 50, 0);
 148   2        }
 149   1      }
 150          
 151          /**
 152           * @brief Task 3: Compressor control task
 153           */
 154          void task_compressor(void) _task_ 3 {
 155   1        while (1) {
 156   2          // Refrigerator compressor control
 157   2          if ((int16_t)temp_refrig > HYSTERESIS_REFRIG_UP) {
 158   3            COMPRESSOR_REFRIG_PIN = 1;  // Turn on compressor
 159   3          } else if ((int16_t)temp_refrig < HYSTERESIS_REFRIG_DOWN) {
 160   3            COMPRESSOR_REFRIG_PIN = 0;  // Turn off compressor
 161   3          }
 162   2      
 163   2          // Freezer compressor control
 164   2          if ((int16_t)temp_freeze > HYSTERESIS_FREEZE_UP) {
 165   3            COMPRESSOR_FREEZE_PIN = 1;  // Turn on compressor
 166   3          } else if ((int16_t)temp_freeze < HYSTERESIS_FREEZE_DOWN) {
 167   3            COMPRESSOR_FREEZE_PIN = 0;  // Turn off compressor
 168   3          }
 169   2      
 170   2          // Wait for 200ms (20 ticks of 10ms each) before checking again
 171   2          os_wait(K_TMO, 20, 0);
 172   2        }
 173   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    531    ----
C51 COMPILER V9.60.7.0   MAIN                                                              12/23/2025 16:35:22 PAGE 4   

   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     37       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
